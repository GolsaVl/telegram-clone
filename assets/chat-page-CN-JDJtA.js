import{c as u,d as F,a as I,r as c,e as H,h as O,f as V,g as h,i as _,u as R,j as t,k as U,U as q,M as W,l as Z,A as X,m as Y}from"./index-ByYu2HNs.js";import{X as G,W as K}from"./x-circle-CUiRJEP9.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=u("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=u("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=u("Film",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M3 7.5h4",key:"zfgn84"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 16.5h4",key:"1230mu"}],["path",{d:"M17 3v18",key:"in4fa5"}],["path",{d:"M17 7.5h4",key:"myr1c1"}],["path",{d:"M17 16.5h4",key:"go4c1d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=u("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=u("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=u("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=u("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=u("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]),ne=e=>{const{socket:s,isConnected:o}=F(),{user:r}=I(),[d,a]=c.useState(!0),[i,x]=c.useState(null),[y,j]=c.useState(null),[g,M]=c.useState(null),{setCurrentChat:f,setMessages:w,addMessage:b,currentChat:N,messages:S}=H();c.useEffect(()=>{if(!e){f(null),a(!1);return}a(!0),x(null);const m=O.find(l=>l.id===e),p=V[e]||[];m?(f(m),w(e,p)):(x(`Chat with ID ${e} not found.`),f(null),w(e,[])),a(!1)},[e,f,w]),c.useEffect(()=>{if(!s||!o||!e)return;s.emit("join_chat",e);const m=l=>{l.chatId===e&&b(e,l)},p=l=>{if(l.userId!==(r==null?void 0:r.id)){j(l.username),g&&window.clearTimeout(g);const k=window.setTimeout(()=>{j(null)},3e3);M(Number(k))}};return s.on("new_message",m),s.on("typing",p),()=>{s.off("new_message",m),s.off("typing",p),s.emit("leave_chat",e),g&&window.clearTimeout(g)}},[s,o,e,r==null?void 0:r.id,g,b,j,M]);const E=(m,p="text",l,k,C,z,T)=>{if(!e||!r)return;const n={id:`msg-${Date.now()}-${Math.random().toString(36).substring(2,7)}`,chatId:e,senderId:h,senderName:_,content:m,type:p,timestamp:new Date().toISOString(),status:"sent",...l&&{url:l},...k&&{fileName:k},...C&&{fileSize:C},...z&&{latitude:z},...T&&{longitude:T}};if(b(e,n),N){const $=N.participants.filter(v=>v.id!==h);if($.length>0){const v=$[0],A=["Got it!","Thanks for the message.","Interesting point.","I'll look into that.","Okay, sounds good.","👍","😄"],B=A[Math.floor(Math.random()*A.length)];setTimeout(()=>{const D={id:`msg-${Date.now()}-${Math.random().toString(36).substring(2,7)}-response`,chatId:e,senderId:v.id,senderName:v.username,content:B,type:"text",timestamp:new Date().toISOString(),status:"read"};b(e,D)},Math.random()*1500+500)}}s&&o&&s.emit("send_message",{chatId:n.chatId,senderId:n.senderId,senderName:n.senderName,content:n.content,type:n.type,status:n.status,url:n.url,fileName:n.fileName,fileSize:n.fileSize,latitude:n.latitude,longitude:n.longitude})},P=()=>{!s||!o||!e||!r||s.emit("typing",{chatId:e,userId:r.id,username:r.username})};return{currentChat:N,messages:e&&S[e]?S[e]:[],loading:d,error:i,typing:y,sendMessage:E,sendTyping:P}},oe=e=>{switch(e){case"online":return{text:"Online",color:"text-green-500",Icon:K};case"away":return{text:"Away",color:"text-yellow-500",Icon:W};case"offline":return{text:"Offline",color:"text-gray-500",Icon:G};default:return{text:"Unknown",color:"text-gray-400",Icon:q}}},ie=({chat:e})=>{const s=R(),{user:o}=I();if(!e)return t.jsx("div",{className:"flex h-16 items-center border-b border-gray-200 dark:border-gray-800 px-4 bg-white dark:bg-gray-900",children:t.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:"Loading chat..."})});const r=e.type==="private"?e.participants.find(x=>x.id!==(o==null?void 0:o.id)):null,d=r?r.username:e.name,a=r?r.avatar:e.avatar,i=r?oe(r.status):null;return t.jsxs("div",{className:"glass-effect flex h-16 items-center justify-between px-4 sticky top-0 z-10",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("button",{onClick:()=>s("/chats"),className:"md:hidden p-1 -ml-1 text-[var(--muted-foreground)] hover:text-[var(--foreground)]","aria-label":"Back to chats",children:t.jsx(J,{size:20})}),a?t.jsx("img",{src:a,alt:d,className:"h-8 w-8 rounded-full object-cover"}):t.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-[var(--muted)] text-sm font-medium uppercase text-[var(--muted-foreground)]",children:d.charAt(0)}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-sm font-medium text-[var(--foreground)]",children:d}),i&&t.jsxs("div",{className:U("text-xs flex items-center gap-1",i.color),children:[t.jsx(i.Icon,{size:12}),t.jsx("span",{children:i.text})]}),e.type==="group"&&!i&&t.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[e.participants.length," members"]})]})]}),t.jsx("button",{className:"p-1 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-white","aria-label":"Chat options",children:t.jsx(se,{size:20})})]})},le=c.memo(({message:e})=>{switch(e.type){case"image":return t.jsx("img",{src:e.url||"https://via.placeholder.com/150",alt:e.content||"Image",className:"rounded-lg max-w-xs max-h-64 object-cover",onLoad:s=>s.target.style.opacity="1",style:{opacity:0,transition:"opacity 0.3s ease-in-out"}});case"video":return t.jsxs("div",{className:"max-w-xs",children:[t.jsx("video",{controls:!0,src:e.url,className:"rounded-lg w-full",children:"Your browser does not support the video tag."}),e.content&&t.jsx("p",{className:"text-sm mt-1",children:e.content})]});case"audio":return t.jsxs("div",{className:"my-1",children:[t.jsx("audio",{controls:!0,src:e.url,className:"w-full max-w-xs",children:"Your browser does not support the audio element."}),e.content&&t.jsx("p",{className:"text-sm mt-1",children:e.content})]});case"file":return t.jsxs("a",{href:e.url||"#",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 p-2 bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:[t.jsx(Q,{size:24,className:"text-gray-600 dark:text-gray-400"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-sm",children:e.fileName||e.content||"Attachment"}),e.fileSize&&t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.fileSize})]})]});case"location":return t.jsxs("a",{href:`https://www.openstreetmap.org/?mlat=${e.latitude}&mlon=${e.longitude}#map=16/${e.latitude}/${e.longitude}`,target:"_blank",rel:"noopener noreferrer",className:"flex flex-col items-start gap-1 p-2 bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx(L,{size:18,className:"text-red-500"}),t.jsx("span",{className:"font-medium text-sm",children:e.content||"Shared Location"})]}),t.jsx("img",{src:`https://static-maps.yandex.ru/1.x/?ll=${e.longitude},${e.latitude}&z=16&l=map&size=280,150&pt=${e.longitude},${e.latitude},pm2rdl`,alt:"Map preview",className:"rounded max-w-[280px] h-[150px] object-cover border dark:border-gray-600",onError:s=>s.currentTarget.style.display="none"}),t.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 hover:underline",children:"View on OpenStreetMap"})]});case"text":default:return t.jsx(t.Fragment,{children:e.content})}});function ue(){const{chatId:e}=Z(),{currentChat:s,messages:o,sendMessage:r}=ne(e),d=c.useRef(null);return c.useEffect(()=>{var a;(a=d.current)==null||a.scrollIntoView({behavior:"smooth"})},[o]),s?t.jsxs("div",{className:"flex flex-col h-full bg-gray-50 dark:bg-gray-950",children:[t.jsx(ie,{chat:s}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[" ",t.jsx(X,{initial:!1,children:o.map((a,i)=>t.jsx(Y.div,{layout:!0,initial:{opacity:0,y:20,scale:.8},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,transition:{duration:.15}},transition:{type:"spring",stiffness:260,damping:20,delay:i*.02},className:`flex mb-4 ${a.senderId===h?"justify-end":"justify-start"}`,children:t.jsx("div",{className:`max-w-[70%] rounded-lg p-3 shadow-md ${a.senderId===h?"bg-blue-500 text-white":"bg-gray-100 dark:bg-gray-800"} ${a.type!=="text"?a.senderId===h?"!bg-blue-500":"!bg-gray-200 dark:!bg-gray-700":""}`,children:t.jsx(le,{message:a})})},a.id))}),t.jsx("div",{ref:d})]}),t.jsx("div",{className:"border-t p-4 bg-white dark:bg-gray-900",children:t.jsxs("form",{onSubmit:a=>{a.preventDefault();const x=a.target.elements.namedItem("message"),y=x.value.trim();y&&(r(y,"text"),x.value="")},className:"flex items-center gap-2",children:[t.jsx("button",{type:"button",onClick:()=>r("Look at this cool image!","image","https://picsum.photos/seed/風景/300/200","landscape.jpg","150 KB"),className:"p-2 text-gray-500 hover:text-blue-500 dark:text-gray-400 dark:hover:text-blue-400",title:"Send Image",children:t.jsx(te,{size:20})}),t.jsx("button",{type:"button",onClick:()=>r("Check out this document.","file","https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf","report.pdf","2 MB"),className:"p-2 text-gray-500 hover:text-blue-500 dark:text-gray-400 dark:hover:text-blue-400",title:"Send File",children:t.jsx(ae,{size:20})}),t.jsx("button",{type:"button",onClick:()=>r("Important video.","video","http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4","bunny.mp4","10 MB"),className:"p-2 text-gray-500 hover:text-blue-500 dark:text-gray-400 dark:hover:text-blue-400",title:"Send Video",children:t.jsx(ee,{size:20})}),t.jsx("button",{type:"button",onClick:()=>r("Listen to this.","audio","https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3","song.mp3","4 MB"),className:"p-2 text-gray-500 hover:text-blue-500 dark:text-gray-400 dark:hover:text-blue-400",title:"Send Audio",children:t.jsx(re,{size:20})}),t.jsx("button",{type:"button",onClick:()=>r("Our meeting spot","location",void 0,void 0,void 0,34.0522,-118.2437),className:"p-2 text-gray-500 hover:text-red-500 dark:text-gray-400 dark:hover:text-red-400",title:"Send Location",children:t.jsx(L,{size:20})}),t.jsx("input",{type:"text",name:"message",placeholder:"Type a message...",className:"flex-1 rounded-lg border p-2 dark:bg-gray-800 dark:border-gray-700"}),t.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"Send"})]})})]}):t.jsx("div",{className:"flex items-center justify-center h-full",children:"Chat not found"})}export{ue as default};
